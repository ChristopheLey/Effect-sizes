---
title             : "The Shieh's d and its relation with Cohen's d"
shorttitle        : "Shieh's d vs Cohen's d"

author:
  - name          : "Marie Delacre"
    affiliation   : "1"
    corresponding : yes
    address       : "CP191, avenue F.D. Roosevelt 50, 1050 Bruxelles"
    email         : "marie.delacre@ulb.ac.be"

affiliation:
  - id            : "1"
    institution   : "Service of Analysis of the Data, Universit√© Libre de Bruxelles, Belgium"

authornote: |

abstract: |

keywords          : "keywords"
wordcount         : "X"

floatsintext      : yes
figurelist        : no
tablelist         : no
footnotelist      : no
linenumbers       : yes
mask              : no
draft             : no

documentclass     : "apa6"
classoption       : "man"
output            : papaja::apa6_pdf
---

```{r setup, include = FALSE}
library("papaja")
```

```{r analysis-preferences}
# Seed for random number generation
set.seed(42)
knitr::opts_chunk$set(cache.extra = knitr::rand_seed)
```

---
title: "Shieh's d vs Cohen's d"
output: pdf_document
---

Unlike the classical Cohen's $\delta$, Shieh's $\delta$ depends on the sample size ratio (that I will call later nratio). For the same amount of differences between two means, same standard deviations (sd) and $\sigma$-ratio, Shieh's $\delta$ will vary as a function of the nratio. To illustrate the relation between Shieh's $\delta$ and the nratio, we can calculate the parameter across a range of nratio. We will first study the Shieh's $\delta$ (and its relation with Cohen's $\delta$) when variances are equal between groups. We will then go through the relation when variances are unequal between groups.
 
# When variances are equal between groups

```{r, include=FALSE}
n=200
mu1=1
mu2=0
sd1=2
sd2=2
shieh<-function(n1)
{
n1 <- n1
n2 <- n-n1
q1<-n1/n
q2<-n2/n
shieh_d<-(mu1-mu2)/sqrt(sd1^2/q1+sd2^2/q2)
pooled_sd<-sqrt(((n1-1)*sd1^2+(n2-1)*sd2^2)/(n1+n2-2))
cohen_d<-(mu1-mu2)/pooled_sd
return(cbind(n1,n2,nratio=n1/n2,shieh=shieh_d,cohen=cohen_d))
}

rep <-data.frame(t(sapply(seq(1,n-1,1),shieh)))
colnames(rep)=c("n1","n2","nratio","shieh","cohen")
```

As a first example, in Figure \ref{fig:SHIEH1}, Cohen's $\delta$ and Shieh's $\delta$ are calculated for different configurations where the observed mean difference ($\mu_{1}-\mu_{2}$) is `r mu1-mu2`, the total sample size is `r n` and standard deviations $\sigma_{1}$ and $\sigma_{2}$ both equals `r sd1`. As one can see, as long as variances are equal between groups, Cohen's $\delta$ remains constant for all nratio, unlike Shieh's $\delta$. Moreover, Shieh's $\delta$ achieves its maximum value when $n_{1}$ = $n_{2}$ (in Figure \ref{fig:SHIEH1}, Shieh's $\delta$ equals `r max(rep$shieh)` when nratio is `r rep$nratio[rep$shieh==max(rep$shieh)]`) \footnote{Because we keep total sample size (n) constant, the larger $n_{1}$, the smaller $n_{2}$. As a consequence, when variances are equal between groups, the larger $\frac{\sigma^2_{1} \times n}{n_{1}}$, the smaller $\frac{\sigma^2_{2} \times n}{n_{2}}$.  $min(\frac{\sigma^2_{1} \times n}{n_{1}}+\frac{\sigma^2_{2} \times n}{n_{2}})$ will be achieved when $\frac{\sigma^2_{1} \times n}{n_{1}}=\frac{\sigma^2_{2} \times n}{n_{2}}$ and therefore when $n_{1}=n_{2}$.}. One can also see that at the maximum point value, the relation between Shieh's $\delta$ and Cohen's $\delta$ is as follows:

\begin{equation} 
\delta_{Cohen}=2 \times max(\delta_{Shieh})  
<-->  max(\delta_{Shieh}) = \frac{\delta_{Cohen}}{2}
(\#eq:cohenshieh)
\end{equation} 

```{r, SHIEH1, fig.cap="Comparison of Shieh's d (black dots) and Cohen's d (grey dots) when mu1 - mu2 = 1, N = 200 and sigma 1 and sigma 2 both equals 2"}
plot(rep[,3],rep[,4],ylim=c(0,.5),pch=19,cex=.3,xlab="n-ratio",ylab="effect size d")
points(rep[,3],rep[,5],pch=19,cex=.3,xlab="n-ratio",col="grey")
abline(h=max(rep$shieh),lty=2,col="lightgrey")
abline(v=rep$nratio[rep$shieh==max(rep$shieh)],lty=2,col="lightgrey")
```

When plotting both parameters against the log of the nratio, one can more easily observe that the Shieh's $\delta$ departs symmetrically from it's maximum value as long as the nratio moves away from 1 (i.e. when log(nratio) = 0; see Figure \ref{fig:SHIEH2}). The relation between all Shieh's $\delta$ values and its value when nratio=1 can be expressed as follows:

\begin{equation} 
max(\delta_{Shieh})= \delta_{Shieh} \times \frac{nratio+1}{2 \times sqrt(nratio)}
(\#eq:shiehvsmax)
\end{equation} 

Because we know from \@ref(eq:cohenshieh) than $max(\delta_{Shieh})$ is half of the value of $\delta_{Cohen}$, we can therefore deduce a more general relation between Cohen's $\delta$ and Shieh's $\delta$:

\begin{equation} 
\delta_{Cohen}= \delta_{Shieh} \times \frac{nratio+1}{sqrt(nratio)}
(\#eq:cohenshiehgen)
\end{equation} 

This relations remains true as long as variances are equal between groups.

```{r, SHIEH2, fig.cap="Comparison of Comparison of Shieh's d (black dots) and Cohen's d (grey dots) when mu1 - mu2 = 1, N = 200 and delta 1 = delta 2 = 2"}
plot(log(rep[,3]),rep[,4],ylim=c(0,.5),pch=19,cex=.3,xlab="log of the n-ratio",ylab="shieh's d")
points(log(rep[,3]),rep[,5],pch=19,cex=.3,xlab="n-ratio",col="grey")
abline(h=max(rep$shieh),lty=2,col="lightgrey")
abline(v=log(rep$nratio[rep$shieh==max(rep$shieh)]),lty=2,col="lightgrey")
```

# When variances are unequal between groups

```{r, include=FALSE}
n = 200
mu1 = 1
mu2 = 0
sd1a = 4
sd2a = 3
 
shieh<-function(n1)
{
n1 <- n1
n2 <- n-n1
q1<-n1/n
q2<-n2/n
shieh_d<-(mu1-mu2)/sqrt(sd1a^2/q1+sd2a^2/q2)
pooled_sd<-sqrt(((n1-1)*sd1a^2+(n2-1)*sd2a^2)/(n1+n2-2))


cohen_d<-(mu1-mu2)/pooled_sd
return(cbind(n1,n2,nratio=n1/n2,shieh=shieh_d,cohen=cohen_d))
}

rep2 <-data.frame(t(sapply(seq(1,n-1,1),shieh)))
colnames(rep2)=c("n1","n2","nratio","shieh","cohen")
```

```{r, include=FALSE}
n = 200
mu1 = 1
mu2 = 0
sd1b = 3
sd2b = 4

shieh<-function(n1)
{
n1 <- n1
n2 <- n-n1
q1<-n1/n
q2<-n2/n
shieh_d<-(mu1-mu2)/sqrt(sd1b^2/q1+sd2b^2/q2)
pooled_sd<-sqrt(((n1-1)*sd1b^2+(n2-1)*sd2b^2)/(n1+n2-2))
cohen_d<-(mu1-mu2)/pooled_sd
return(cbind(n1,n2,nratio=n1/n2,shieh=shieh_d,cohen=cohen_d))
}

rep3 <-data.frame(t(sapply(seq(1,n-1,1),shieh)))
colnames(rep3)=c("n1","n2","nratio","shieh","cohen")
```

In Figure \ref{fig:SHIEH3}, Cohen's $\delta$ and Shieh's $\delta$ are calculated for different configurations where the observed mean difference ($\mu_{1}-\mu_{2}$) is `r mu1-mu2`, the total sample size is `r n` and standard deviations $\sigma_{1}$ and $\sigma_{2}$ are respectively `r sd1a` and `r sd2a` (left) or `r sd1b` and `r sd2b` (right). As one can see, when variances are unequal between groups, Cohen's $\delta$ no longer remains constant for all nratio.

```{r, SHIEH3, fig.cap="Comparison of Shieh's d (black dots) and Cohen's d (grey dots) when mu1 - mu2 = 1, N = 200 and sigma 1 and sigma 2 are respectively 4 and 2 (left) or 2 and 4 (right)"}
par(mfrow=c(1,2))
plot(rep2[,3],rep2[,4],ylim=c(0,.5),pch=19,cex=.3,xlab="n-ratio",ylab="effect size d")
points(rep2[,3],rep2[,5],pch=19,cex=.3,xlab="n-ratio",col="grey")
abline(h=max(rep2$shieh),lty=2,col="lightgrey")
abline(v=rep2$nratio[rep2$shieh==max(rep2$shieh)],lty=2,col="lightgrey")

plot(rep3[,3],rep3[,4],ylim=c(0,.5),pch=19,cex=.3,xlab="n-ratio",ylab="effect size d")
points(rep3[,3],rep3[,5],pch=19,cex=.3,xlab="n-ratio",col="grey")
abline(h=max(rep3$shieh),lty=2,col="lightgrey")
abline(v=rep3$nratio[rep3$shieh==max(rep3$shieh)],lty=2,col="lightgrey")
```

Once again, it is easier to study the influence of the nratio on both parameters when plotting them against the log of the nratio, as done in Figure \ref{fig:SHIEH4}. **Cohen's $\delta$** is the difference between both groups means, divided by a pooled error term:

\begin{equation} 
\delta_{Cohen}= \sqrt{\frac{\mu_{1}-\mu_{2}}{\frac{(n_{1}-1) \times \sigma^2_{1} + (n_{2}-1) \times \sigma^2_{2}}{n_{1}+n_{2}-2}}}
(\#eq:cohen)
\end{equation} 

This implies that all samples are considered as issued from a common population variance (hence the assumption of homoscedasticity). When there is heteroscedasticity, if the larger variance is associated with the larger sample size (i.e. the colored parts on both plots in Figure \ref{fig:SHIEH4}), the error term is overestimated and therefore, the Cohen's $\delta$ is decreased. The smallest value is achieved when the sample size of the group associated with the largest variance equals n-1=`r n-1`. On the other side, if the larger variance is associated with the smaller sample size (i.e. the non-colored parts of both plots), the error term is underestimated and therefore, the Cohen's $\delta$ is increased. The largest value is achieved when the sample size of the group associated with the largest variance equals `r 1`.   

```{r, SHIEH4, fig.cap="Comparison of Shieh's d (black dots) and Cohen's d (grey dots) when mu1 - mu2 = 1, N = 200 and sigma 1 and sigma 2 are respectively 4 and 2 (left) or 2 and 4 (right)"}
par(mfrow=c(1,2))
plot(log(rep2[,3]),rep2[,4],ylim=c(0,.4),pch=19,cex=.3,xlab="log of the n-ratio",ylab="effect size d")
points(log(rep2[,3]),rep2[,5],pch=19,cex=.3,xlab="n-ratio",col="grey")
abline(h=max(rep2$shieh),lty=2,col="lightgrey")
#abline(v=log(rep2$nratio[rep2$shieh==max(rep2$shieh)]),lty=2,col="lightgrey")
abline(v=0,col="grey")
rect(0,-.5,6,.5, col = rgb(0,1,0,alpha=0.2),density=50)

plot(log(rep3[,3]),rep3[,4],ylim=c(0,.4),pch=19,cex=.3,xlab="log of the n-ratio",ylab="effect size d")
points(log(rep3[,3]),rep3[,5],pch=19,cex=.3,xlab="n-ratio",col="grey")
abline(h=max(rep3$shieh),lty=2,col="lightgrey")
#abline(v=log(rep3$nratio[rep3$shieh==max(rep3$shieh)]),lty=2,col="lightgrey")
abline(v=0,col="grey")
rect(-6,-.5,0,.5, col = rgb(0,1,0,alpha=0.2),density=50)

#max(rep2$cohen)-rep2$cohen[rep2$nratio==1]
#min(rep2$cohen)-rep2$cohen[rep2$nratio==1]
#max(rep3$cohen)
#min(rep3$cohen)
```

```{r, include=FALSE}
n=10000
mu1=1
mu2=0
sd2=1

# set 2 empty containers
shieh<-function(sd1){
  nratio<-NULL
  shieh_d<-NULL
#  cohen_d<-NULL

  for (i in seq_len(n-1)){
  n1 <- i
  n2 <- n-n1
  nratio[i] <- n1/n2
  q1<-n1/n
  q2<-n2/n
  shieh_d[i]<-(mu1-mu2)/sqrt(sd1^2/q1+sd2^2/q2)
#  pooled_sd<-sqrt(((n1-1)*sd1^2+(n2-1)*sd2^2)/(n1+n2-2))
#  cohen_d[i]<-(mu1-mu2)/pooled_sd
}

#   if (length(nratio[cohen_d==max(cohen_d)])==1){
#   ratio_maxcohen <- nratio[cohen_d==max(cohen_d)]
#   } else {ratio_maxcohen <- "multiple answers"}
 
#   if (length(nratio[cohen_d==max(cohen_d)])==1){
#   ratio_mincohen <- nratio[cohen_d==min(cohen_d)]
#   } else {ratio_mincohen <- "multiple answers"}

   if (length(nratio[shieh_d==max(shieh_d)])==1){
   ratio_maxshieh <- nratio[shieh_d==max(shieh_d)]
   } else {ratio_maxshieh <- "multiple answers"}

return(cbind(sdratio=sd1,maxshieh_ratio=ratio_maxshieh)) # as sd1=1, sd-ratio = sd2/sd1 =
}

rep <-data.frame(t(sapply(seq(1/50,50,.02),shieh))) 
colnames(rep)=c("sdratio","maxshieh_ratio") 
#View(rep)
```

While it remains true that when $n_{1}=n_{2}$, the Cohen's $\delta$ is exactly as twice as large as Shieh's $\delta$, the maximum Shieh's $\delta$ value is not achieved when the nratio equals 1 (i.e the log of the nratio equals 0).  When there is heteroscedasticity and unequal sample sizes, the maximum Shieh's $\delta$ is always achieved when there is a positive correlation between variances and sample sizes and the more unequal the variances, the further from 1 the nratio associated with the maximum. As an illustration, we computed Shieh's $\delta$ values for difference configurations where $\sigma_{2}=1$, total sample size = `r n` and $\mu_{1}-\mu_{2}=1$, and the nratio varies from $\frac{1}{n-1}$ to n-1, and we extracted the nratio at which Shieh's $\delta$ was the largest (=$nratio_{largest \space \delta}$). All configurations varied as a function of $\sigma_{1}$, which varied from .02 to 50, in steps of .02 (so does the $\sigma$-ratio). In Figure \ref{fig:SHIEH5}, we plotted the $\sigma$-ratio against $nratio_{largest \space \delta}$.

As one can observe, when the $\sigma$-ratio is larger than 1 (i.e. $\sigma_{1} > \sigma_{1}$), the nratio associated with the largest Shieh's $\delta$ value is also larger than 1(i.e. $n_{1} > n_{2}$). On the other side, when the $\sigma$-ratio is lower than 1 (i.e. $\sigma_{1} < \sigma_{1}$), the nratio associated with the largest Shieh's $\delta$ value is also lower than 1 (i.e. $n_{1} < n_{2}$), and the relation between $nratio_{largest \space \delta}$ and $\sigma$-ratio seems linear. 

```{r, SHIEH5, fig.cap="At which nratio the largest value of Shieh's d is achieved, as a function of the sd-ratio ( = sd1/sd2)"}
par(mfrow=c(1,1))
plot(rep$sdratio,rep$maxshieh_ratio,pch=19,cex=.1,xlab="sd-ratio",ylab="nratio associated which largest shieh's d value")
abline(v=1,lty=2,col="lightgrey")
abline(h=1,lty=2,col="lightgrey")
```

This result can be easily explained: **Shieh's $\delta$** is the difference between both groups means, divided an error term where variances $\sigma_{j}$ are weighted by $\frac{n}{n_{j}}$:

\begin{equation} 
\delta_{Shieh}= \frac{\mu_{1}-\mu_{2}}{\sqrt{\frac{\sigma^2_{1} \times n}{n_{1}}+\frac{\sigma^2_{2} \times n}{n_{2}}}}
(\#eq:shieh)
\end{equation} 

It implies that when there is a positive correlation between sample size and $\sigma$-ratio, the group with smallest variance is given more weight. As a consequence, the error term is decreased and the Shieh's $\delta$ is increased.  When there is a negative correlation between sample size and $\sigma$-ratio, the group with largest variance is given more weight and therefore, the error term is increased, and the Shieh's $\delta$ is decreased. FINISH TO EXPLAIN THIS

